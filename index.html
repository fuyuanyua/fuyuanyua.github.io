<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  

  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-2019-04-21-23上海旅行规划" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/20/2019-04-21-23上海旅行规划/" class="article-date">
  <time datetime="2019-04-20T06:02:49.000Z" itemprop="datePublished">2019-04-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/20/2019-04-21-23上海旅行规划/">2019.04.21-23上海旅行规划</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="2019-04-21"><a href="#2019-04-21" class="headerlink" title="2019.04.21"></a>2019.04.21</h2><h3 id="上午："><a href="#上午：" class="headerlink" title="上午："></a>上午：</h3><ol>
<li>宁波（09:54）——上海虹桥（12:10）</li>
</ol>
<h3 id="中午："><a href="#中午：" class="headerlink" title="中午："></a>中午：</h3><ol>
<li><p>午餐</p>
<ul>
<li>富贵面馆</li>
<li>牛蛙面</li>
<li>安顺路175号</li>
<li>地铁<code>10号线</code>（<code>虹桥火车站</code>上，<code>虹桥路</code>下）</li>
</ul>
</li>
</ol>
<h3 id="下午："><a href="#下午：" class="headerlink" title="下午："></a>下午：</h3><ol>
<li><p>上海当代艺术博物馆</p>
<ul>
<li>门票20元起</li>
<li>黄浦区苗江路678号</li>
<li>地铁<code>4号线外圈</code>（<code>虹桥路</code>上，<code>西藏南路</code>下）</li>
</ul>
</li>
<li><p>INVINCIBLE</p>
<ul>
<li>鞋店</li>
<li>SOHO复兴广场，马当路388号103</li>
<li>地铁<code>8号线</code>（<code>西藏南路</code>上，<code>老西门</code>下），地铁10号线（<code>老西门</code>上，<code>新天地</code>下）</li>
</ul>
</li>
<li><p>CONCEPTS</p>
<ul>
<li>鞋店</li>
<li>上海新天地，兴业路123弄2</li>
<li>步行</li>
</ul>
</li>
<li><p>DOE</p>
<ul>
<li>鞋店</li>
<li>黄浦区湖滨路168号</li>
<li>步行</li>
</ul>
</li>
<li><p>晚餐</p>
<ul>
<li>SHAKE SHACK</li>
<li>汉堡</li>
<li>上海新天地，太仓路181弄10号</li>
<li>步行</li>
</ul>
</li>
</ol>
<h3 id="晚上："><a href="#晚上：" class="headerlink" title="晚上："></a>晚上：</h3><ol>
<li><p>南京东路</p>
<ul>
<li>上海001，南京路步行街，外滩，上海市人民英雄纪念塔</li>
<li>地铁<code>1号线</code>（<code>黄陂南路</code>上，<code>人民广场</code>下）</li>
</ul>
</li>
<li><p>回家</p>
<ul>
<li>徐汇区复兴中路1218弄</li>
<li>地铁<code>10号线</code>（<code>南京东路</code>上，<code>陕西南路</code>下）</li>
</ul>
</li>
</ol>
<h2 id="2019-04-22"><a href="#2019-04-22" class="headerlink" title="2019.04.22"></a>2019.04.22</h2><h3 id="上午：-1"><a href="#上午：-1" class="headerlink" title="上午："></a>上午：</h3><ol>
<li><p>早餐</p>
<ul>
<li>暂定</li>
</ul>
</li>
<li><p>甜爱路</p>
<ul>
<li>甜爱路，鲁迅纪念馆，多伦路文化名人街</li>
<li>地铁<code>1号线</code>（<code>陕西南路</code>上，<code>人民广场</code>下），地铁<code>8号线</code>（<code>人民广场</code>上，<code>虹口足球场</code>下）</li>
</ul>
</li>
</ol>
<h3 id="中午：-1"><a href="#中午：-1" class="headerlink" title="中午："></a>中午：</h3><ol>
<li><p>午餐</p>
<ul>
<li>蟹黄鱼</li>
<li>黄浦区太仓路200号一层B区</li>
<li>地铁<code>8号线</code>（<code>虹口足球场</code>上，<code>人民广场</code>下），地铁<code>1号线</code>（<code>人民广场</code>上，<code>黄陂南路</code>下）</li>
</ul>
</li>
</ol>
<h3 id="下午：-1"><a href="#下午：-1" class="headerlink" title="下午："></a>下午：</h3><ol>
<li><p>武康路</p>
<ul>
<li>武康大楼，巴金故居，法租界</li>
<li>地铁<code>1号线</code>（<code>黄陂南路</code>上，<code>陕西南路</code>下），地铁<code>10号线</code>（<code>陕西南路</code>上，<code>交通大学</code>下）</li>
</ul>
</li>
<li><p>JUICE SH</p>
<ul>
<li>鞋店</li>
<li>静安区巨鹿路832号 </li>
<li>步行或骑车</li>
</ul>
</li>
<li><p>暂定</p>
<ul>
<li>暂定</li>
<li>暂定 </li>
<li>暂定</li>
</ul>
</li>
<li><p>晚餐</p>
<ul>
<li>暂定</li>
<li>暂定 </li>
<li>暂定</li>
</ul>
</li>
</ol>
<h3 id="晚上：-1"><a href="#晚上：-1" class="headerlink" title="晚上："></a>晚上：</h3><ol>
<li><p>Troye Sivan演唱会</p>
<ul>
<li>开始时间（20:00）</li>
<li>上海梅赛德斯奔驰文化中心</li>
<li>视情况而定</li>
</ul>
</li>
</ol>
<hr>
<h3 id="暂定可选"><a href="#暂定可选" class="headerlink" title="暂定可选"></a>暂定可选</h3><ul>
<li>哈灵面馆（牛蛙面）</li>
<li>鲜得来（排骨年糕）</li>
<li>红宝石（奶油小方，栗子蛋糕）</li>
<li>平成屋日料</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/04/20/2019-04-21-23上海旅行规划/" data-id="cjupmu0sn0001cwrclfvjgenc" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/旅行/">旅行</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Spring-Boot邮件操作" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/19/Spring-Boot邮件操作/" class="article-date">
  <time datetime="2019-04-19T06:48:39.000Z" itemprop="datePublished">2019-04-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/19/Spring-Boot邮件操作/">Spring Boot邮件操作</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="1-简单邮件"><a href="#1-简单邮件" class="headerlink" title="1. 简单邮件"></a>1. 简单邮件</h2><h3 id="1-1-引入邮件依赖"><a href="#1-1-引入邮件依赖" class="headerlink" title="1.1 引入邮件依赖"></a>1.1 引入邮件依赖</h3><p>新建项目时在引入依赖时勾选I/O中的Mail选项，项目创建好后查看pom.xml文件有此依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-mail<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="1-2-配置application-yml文件"><a href="#1-2-配置application-yml文件" class="headerlink" title="1.2 配置application.yml文件"></a>1.2 配置<code>application.yml</code>文件</h3><p>以qq邮箱为例，</p>
<ul>
<li>spring.mail.username为邮箱名，已打码。</li>
<li>spring.mail.password为授权第三方登录的密码。</li>
<li>设置发送邮件的服务器。</li>
<li>设置SSL连接为true。</li>
</ul>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置邮箱信息</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  mail:</span></span><br><span class="line"><span class="attr">    username:</span> <span class="string">xxxxxxxxx@qq.com</span></span><br><span class="line"><span class="attr">    password:</span> <span class="string">sroomflkeutvbbfj</span></span><br><span class="line">    <span class="comment"># 发送邮件服务器</span></span><br><span class="line"><span class="attr">    host:</span> <span class="string">smtp.qq.com</span></span><br><span class="line">    <span class="comment"># SSL连接</span></span><br><span class="line">    <span class="string">properties.smtp.ssl.enable:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<h3 id="1-3-测试类"><a href="#1-3-测试类" class="headerlink" title="1.3 测试类"></a>1.3 测试类</h3><ul>
<li><code>@Autowired
 JavaMailSenderImpl javaMailSender;</code>注入JavaMailSenderImpl。</li>
<li><code>SimpleMailMessage</code>类 封装了简单邮件。</li>
<li><code>simpleMailMessage.setFrom()</code>发送方邮箱，已打码。</li>
<li><code>simpleMailMessage.setTo()</code>接收方邮箱，已打码。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringRunner.class)</span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringBoot12MailApplicationTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    JavaMailSenderImpl javaMailSender;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//简单邮件测试</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSimpleMail</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//SimpleMailMessage类，封装简单邮件</span></span><br><span class="line">        SimpleMailMessage simpleMailMessage = <span class="keyword">new</span> SimpleMailMessage();</span><br><span class="line">        <span class="comment">//设置邮件主题（标题）</span></span><br><span class="line">        simpleMailMessage.setSubject(<span class="string">"标题测试"</span>);</span><br><span class="line">        <span class="comment">//设置邮件正文</span></span><br><span class="line">        simpleMailMessage.setText(<span class="string">"正文测试"</span>);</span><br><span class="line">        <span class="comment">//设置发件人</span></span><br><span class="line">        simpleMailMessage.setFrom(<span class="string">"xxxxxxxxx@qq.com"</span>);</span><br><span class="line">        <span class="comment">//设置收件人</span></span><br><span class="line">        simpleMailMessage.setTo(<span class="string">"xxxxxxxxx@gmail.com"</span>);</span><br><span class="line">        javaMailSender.send(simpleMailMessage);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-4-运行"><a href="#1-4-运行" class="headerlink" title="1.4 运行"></a>1.4 运行</h3><p>接收方邮箱便能收到这份简单邮件。</p>
<h2 id="2-复杂邮件"><a href="#2-复杂邮件" class="headerlink" title="2. 复杂邮件"></a>2. 复杂邮件</h2><h3 id="2-1-引入邮件依赖"><a href="#2-1-引入邮件依赖" class="headerlink" title="2.1 引入邮件依赖"></a>2.1 引入邮件依赖</h3><p>同1.1，略。</p>
<h3 id="2-2-配置application-yml文件"><a href="#2-2-配置application-yml文件" class="headerlink" title="2.2 配置application.yml文件"></a>2.2 配置<code>application.yml</code>文件</h3><p>同1.2，略。</p>
<h3 id="2-3-测试类"><a href="#2-3-测试类" class="headerlink" title="2.3 测试类"></a>2.3 测试类</h3><ul>
<li><code>MimeMessage</code>类的对象不能直接设置标题正文等发送内容。</li>
<li><code>MimeMessageHelper mimeMessageHelper = new MimeMessageHelper(mimeMessage, true);</code>需要通过MimeMessageHelper类的对象来设置发送内容。</li>
<li><code>mimeMessageHelper.setText()</code>第二个参数设置为true，才能使用html代码。</li>
<li><code>mimeMessageHelper.addAttachment()</code>设置附件，第一个参数指定附件名。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringRunner.class)</span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringBoot12MailApplicationTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    JavaMailSenderImpl javaMailSender;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//复杂邮件测试</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMimeMail</span><span class="params">()</span> <span class="keyword">throws</span> MessagingException </span>&#123;</span><br><span class="line">        <span class="comment">//MimeMessage类</span></span><br><span class="line">        MimeMessage mimeMessage = javaMailSender.createMimeMessage();</span><br><span class="line">        <span class="comment">//通过MimeMessage帮助对象 来设置发送内容，第二个参数为true表示可以发送附件</span></span><br><span class="line">        MimeMessageHelper mimeMessageHelper = <span class="keyword">new</span> MimeMessageHelper(mimeMessage, <span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">//设置邮件主题（标题）</span></span><br><span class="line">        mimeMessageHelper.setSubject(<span class="string">"标题测试1"</span>);</span><br><span class="line">        <span class="comment">//设置邮件正文,第二个参数设置为true，才可以发送html代码</span></span><br><span class="line">        mimeMessageHelper.setText(<span class="string">"&lt;h2 style='color:red'&gt;正文测试2&lt;/h2&gt;"</span>, <span class="keyword">true</span>);</span><br><span class="line">        mimeMessageHelper.addAttachment(<span class="string">"1.jpg"</span>, <span class="keyword">new</span> File(<span class="string">"D:\\用户目录\\我的图片\\02_CONVERSEXMDNS_LANDINGPAGE_20181007_01.jpg"</span>));</span><br><span class="line">        <span class="comment">//设置发件人</span></span><br><span class="line">        mimeMessageHelper.setFrom(<span class="string">"xxxxxxxxx@qq.com"</span>);</span><br><span class="line">        <span class="comment">//设置收件人</span></span><br><span class="line">        mimeMessageHelper.setTo(<span class="string">"xxxxxxxxx@gmail.com"</span>);</span><br><span class="line">        javaMailSender.send(mimeMessage);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-4-运行"><a href="#2-4-运行" class="headerlink" title="2.4 运行"></a>2.4 运行</h3><p>接收方邮箱便能收到邮件，且邮件带有一份名为1.jpg的附件。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/04/19/Spring-Boot邮件操作/" data-id="cjupmu0sy000bcwrcrv7cnffx" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Spring-Boot/">Spring Boot</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/邮件/">邮件</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Spring-Boot异步任务和定时任务" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/17/Spring-Boot异步任务和定时任务/" class="article-date">
  <time datetime="2019-04-17T09:17:42.000Z" itemprop="datePublished">2019-04-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/17/Spring-Boot异步任务和定时任务/">Spring Boot异步任务和定时任务</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="1-异步任务"><a href="#1-异步任务" class="headerlink" title="1. 异步任务"></a>1. 异步任务</h2><h3 id="1-1-简介"><a href="#1-1-简介" class="headerlink" title="1.1 简介"></a>1.1 简介</h3><p>项目开发中，绝大多数情况是通过同步方式处理业务逻辑，但批量处理数据，批量发送邮件等容易造成阻塞，之前都是通过使用多线程来完成此类任务。</p>
<p>在Spring 3+后内置了<code>@Async</code>注解来解决此类问题，提高效率。</p>
<h3 id="1-2-启动类上使用-EnableAsync注解"><a href="#1-2-启动类上使用-EnableAsync注解" class="headerlink" title="1.2 启动类上使用@EnableAsync注解"></a>1.2 启动类上使用<code>@EnableAsync</code>注解</h3><p>在启动类上使用<code>@EnableAsync</code>注解，开启基于注解版的异步处理。</p>
<p>代码示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableAsync</span> <span class="comment">//开启基于注解版的异步处理</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringBoot11TaskApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(SpringBoot11TaskApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-3-在方法上使用-Async注解"><a href="#1-3-在方法上使用-Async注解" class="headerlink" title="1.3 在方法上使用@Async注解"></a>1.3 在方法上使用<code>@Async</code>注解</h3><p>在方法上标识<code>@Async</code>注解，该方法就会基于异步处理。</p>
<p>代码示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AsyncService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Async</span> <span class="comment">//在该方法上标识注解，该方法就会基于异步处理</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">batchAdd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//模拟新增数据</span></span><br><span class="line">            Thread.sleep(<span class="number">3</span>*<span class="number">1000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"批量新增数据完成"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="2-定时任务"><a href="#2-定时任务" class="headerlink" title="2. 定时任务"></a>2. 定时任务</h2><h3 id="2-1-简介"><a href="#2-1-简介" class="headerlink" title="2.1 简介"></a>2.1 简介</h3><p>在项目开发中，经常要执行一些定时任务。</p>
<h3 id="2-2-启动类上使用-EnableScheduling注解"><a href="#2-2-启动类上使用-EnableScheduling注解" class="headerlink" title="2.2 启动类上使用@EnableScheduling注解"></a>2.2 启动类上使用<code>@EnableScheduling</code>注解</h3><p>在启动类上使用<code>@EnableScheduling</code>注解，开启注解版的定时任务。</p>
<p>代码示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableScheduling</span> <span class="comment">//开启注解版的定时任务</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringBoot11TaskApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(SpringBoot11TaskApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-3-在方法上使用-Scheduled注解"><a href="#2-3-在方法上使用-Scheduled注解" class="headerlink" title="2.3 在方法上使用@Scheduled注解"></a>2.3 在方法上使用<code>@Scheduled</code>注解</h3><p>代码示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ScheduledService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> count = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * on the second(秒) as well as minute(分), hour(时), day(天) of month, month(月) and day of week(星期).</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;E.g. &#123;<span class="doctag">@code</span> "0 * * * * MON-FRI"&#125; means once per minute on weekdays 表示在工作日（周一到周五）每分钟执行一次</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">//cron = "*/3 * * * * MON-FRI"表示在周一到周五每三秒执行一次</span></span><br><span class="line">    <span class="meta">@Scheduled</span>(cron = <span class="string">"*/3 * * * * MON-FRI"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dataCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"数据统计第"</span> + count++ + <span class="string">"次"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-3-Scheduled详解"><a href="#2-3-Scheduled详解" class="headerlink" title="2.3 @Scheduled详解"></a>2.3 <code>@Scheduled</code>详解</h3><ul>
<li><p><code>@Scheduled(cron = &quot;*/3 * * * * MON-FRI&quot;)</code>：通过cron表达式定义规则。</p>
<p>cron表达式自动生成网站：</p>
<p><a href="http://cron.qqe2.com/" target="_blank" rel="noopener">http://cron.qqe2.com/</a></p>
</li>
</ul>
<table>
<thead>
<tr>
<th>从左到右依次</th>
<th>取值范围</th>
<th>可指定的特殊字符</th>
</tr>
</thead>
<tbody>
<tr>
<td>秒</td>
<td>0-59</td>
<td>, - * /</td>
</tr>
<tr>
<td>分</td>
<td>0-59</td>
<td>, - * /</td>
</tr>
<tr>
<td>小时</td>
<td>0-23</td>
<td>, - * /</td>
</tr>
<tr>
<td>日期</td>
<td>1-31</td>
<td>, - * / ? L W C</td>
</tr>
<tr>
<td>月份</td>
<td>1-12</td>
<td>, - * /</td>
</tr>
<tr>
<td>星期</td>
<td>0-7或MON-SUN（0和7都代表周日，1-6代表周一到周六）</td>
<td>, - * / ? L C #</td>
</tr>
</tbody>
</table>
<ul>
<li><p><code>@Scheduled(fixedRate = 3000)</code>:上一次开始执行时间点之后3秒再执行。</p>
</li>
<li><p><code>@Scheduled(fixedDelay = 3000)</code>：上一次执行完毕时间点之后3秒再执行。</p>
</li>
<li><p><code>@Scheduled(initialDelay=1000, fixedRate=3000)</code>：第一次延迟1秒后执行，之后按fixedRate的规则每3秒执行一次。</p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/04/17/Spring-Boot异步任务和定时任务/" data-id="cjupmu0st0005cwrcmhn8x4vo" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Spring-Boot/">Spring Boot</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/定时任务/">定时任务</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/异步任务/">异步任务</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Spring-Boot整合MyBatis" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/10/Spring-Boot整合MyBatis/" class="article-date">
  <time datetime="2019-04-10T10:53:30.000Z" itemprop="datePublished">2019-04-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/10/Spring-Boot整合MyBatis/">Spring Boot整合MyBatis</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="1-Spring-Boot整合MyBatis配置文件版"><a href="#1-Spring-Boot整合MyBatis配置文件版" class="headerlink" title="1. Spring Boot整合MyBatis配置文件版"></a>1. Spring Boot整合MyBatis配置文件版</h2><h3 id="1-1-建表"><a href="#1-1-建表" class="headerlink" title="1.1 建表"></a>1.1 建表</h3><p>使用MySQL数据库，新建一个名为“mybatis”的schema，分别建“bill“、”provider“和”user“表并添加数据。</p>
<h3 id="1-2-application-yml全局配置文件"><a href="#1-2-application-yml全局配置文件" class="headerlink" title="1.2 application.yml全局配置文件"></a>1.2 <code>application.yml</code>全局配置文件</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  datasource:</span></span><br><span class="line"><span class="attr">    username:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">    password:</span> <span class="string">root</span></span><br><span class="line">    <span class="comment"># mysql-connector-java 8.0版本以上的驱动包要指定时区</span></span><br><span class="line"><span class="attr">    url:</span> <span class="attr">jdbc:mysql://localhost:3306/mybatis?serverTimezone=GMT%2B8</span></span><br><span class="line">    <span class="comment"># mysql-connector-java 8.0版本以上指定了新的驱动类</span></span><br><span class="line"><span class="attr">    driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="comment"># 使用阿里的Druid（德鲁伊）数据源</span></span><br><span class="line"><span class="attr">    type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 数据源其他配置</span></span><br><span class="line"><span class="attr">    initialSize:</span> <span class="number">5</span></span><br><span class="line"><span class="attr">    minIdle:</span> <span class="number">5</span></span><br><span class="line"><span class="attr">    maxActive:</span> <span class="number">20</span></span><br><span class="line"><span class="attr">    maxWait:</span> <span class="number">60000</span></span><br><span class="line"><span class="attr">    timeBetweenEvictionRunsMillis:</span> <span class="number">60000</span></span><br><span class="line"><span class="attr">    minEvictableIdleTimeMillis:</span> <span class="number">300000</span></span><br><span class="line"><span class="attr">    validationQuery:</span> <span class="string">SELECT</span> <span class="number">1</span> <span class="string">FROM</span> <span class="string">DUAL</span></span><br><span class="line"><span class="attr">    testWhileIdle:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    testOnBorrow:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">    testOnReturn:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">    poolPreparedStatements:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment"># 配置监控统计拦截的filters，去掉后监控界面sql无法统计，'wall'用于防火墙</span></span><br><span class="line"><span class="attr">    filters:</span> <span class="string">stat,wall,logback</span></span><br><span class="line"><span class="attr">    maxPoolPreparedStatementPerConnectionSize:</span> <span class="number">20</span></span><br><span class="line"><span class="attr">    useGlobalDataSourceStat:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    connectionProperties:</span> <span class="string">druid.stat.mergeSql=true;druid.stat.slowSqlMillis=500</span></span><br></pre></td></tr></table></figure>
<h3 id="1-3-创建实体类"><a href="#1-3-创建实体类" class="headerlink" title="1.3 创建实体类"></a>1.3 创建实体类</h3><p>在 com.example.springboot.entities 包下创建Provider实体类和Bill实体类。</p>
<ul>
<li><p>Provider类：</p>
<p>为减少篇幅，这里只给出成员变量，有参、无参构造方法，get，set，toString方法均省略。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">public class Provider &#123;</span><br><span class="line">    private Integer pid;</span><br><span class="line">    //供应商编码</span><br><span class="line">    private String providerCode;</span><br><span class="line">    //供应商名称</span><br><span class="line">    private String providerName;</span><br><span class="line">    //联系人</span><br><span class="line">    private String people;</span><br><span class="line">    //联系电话</span><br><span class="line">    private String phone;</span><br><span class="line">    //联系地址</span><br><span class="line">    private String address;</span><br><span class="line">    //传真</span><br><span class="line">    private String fax;</span><br><span class="line">    //描述</span><br><span class="line">    private String describe;</span><br><span class="line">    // 创建时间</span><br><span class="line">    private Date createDate;</span><br><span class="line"></span><br><span class="line">	其余代码省略。。。</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Bill类：</p>
<p>为减少篇幅，这里只给出成员变量，有参、无参构造方法，get，set，toString方法均省略。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">public class Bill &#123;</span><br><span class="line"></span><br><span class="line">    private Integer bid;</span><br><span class="line">    // 账单编码</span><br><span class="line">    private String billCode;</span><br><span class="line">    // 商品名称</span><br><span class="line">    private String billName;</span><br><span class="line">    // 商品单位</span><br><span class="line">    private String billCom;</span><br><span class="line">    // 商品数量</span><br><span class="line">    private Integer billNum;</span><br><span class="line">    // 总金额</span><br><span class="line">    private Double money;</span><br><span class="line">    // 供应商</span><br><span class="line">    private Provider provider;</span><br><span class="line">    // 是否付款 0 未付款， 1已付款</span><br><span class="line">    private Integer pay;</span><br><span class="line">    // 创建时间</span><br><span class="line">    private Date createDate;</span><br><span class="line">	</span><br><span class="line">	其余代码省略。。。</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="1-4-创建Mapper接口"><a href="#1-4-创建Mapper接口" class="headerlink" title="1.4 创建Mapper接口"></a>1.4 创建Mapper接口</h3><p>在 com.example.springboot.mapper 包下创建 BillMapper 接口：</p>
<ul>
<li>可在各Mapper接口上使用<code>@Mapper</code>注解，表明这是一个Mapper接口。</li>
<li>也可在启动类上直接使用注解<code>@MapperScan(&quot;com.example.springboot.mapper&quot;)</code>，便能扫描该包下的所有Mapper自动装到容器当中，而不用在各Mapper上加上注解<code>@Mapper</code>。</li>
</ul>
<p>代码示例：</p>
<ul>
<li><p>BillMapper接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用MyBatis配置文件版</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//@Mapper 或者在启动类上使用注解 @MapperScan("com.example.springboot.mapper")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BillMapper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//接口方法默认被public修饰</span></span><br><span class="line">    <span class="function">Bill <span class="title">getBillByBid</span><span class="params">(Integer bid)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">addBill</span><span class="params">(Bill bill)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">updateBill</span><span class="params">(Bill bill)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">deleteBill</span><span class="params">(Integer bid)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MapperScan</span>(<span class="string">"com.example.springboot.mapper"</span>)</span><br><span class="line"><span class="comment">//扫描该包下的所有Mapper自动装到容器当中，而不用在各Mapper上加上注解@Mapper</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringBoot08DataMybatisApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(SpringBoot08DataMybatisApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="1-5-创建MyBatis核心配置文件"><a href="#1-5-创建MyBatis核心配置文件" class="headerlink" title="1.5 创建MyBatis核心配置文件"></a>1.5 创建MyBatis核心配置文件</h3><p>在resources目录下新建mybatis目录，在该目录下创建<code>mybatis-config.xml</code>，这便是MyBatis核心配置文件，我在这仅仅配置了开启自动驼峰命名规则映射，文件编写参考官方文档：<a href="http://www.mybatis.org/mybatis-3/zh/getting-started.html" target="_blank" rel="noopener">http://www.mybatis.org/mybatis-3/zh/getting-started.html</a></p>
<p>代码示例：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE configuration</span></span><br><span class="line"><span class="meta">        PUBLIC "-//mybatis.org//DTD Config 3.0//EN"</span></span><br><span class="line"><span class="meta">        "http://mybatis.org/dtd/mybatis-3-config.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 这是mybatis核心配置文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 是否开启自动驼峰命名规则（camel case）映射，</span></span><br><span class="line"><span class="comment">        即从经典数据库列名 A_COLUMN 到经典 Java 属性名 aColumn 的类似映射 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"mapUnderscoreToCamelCase"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="1-6-创建Mapper映射配置文件"><a href="#1-6-创建Mapper映射配置文件" class="headerlink" title="1.6 创建Mapper映射配置文件"></a>1.6 创建Mapper映射配置文件</h3><p>在resources目录的mybatis目录下新建mapper目录，在该目录下创建<code>BillMapper.xml</code>，在此文件中编写sql语句，文件编写也参考官网文档：<a href="http://www.mybatis.org/mybatis-3/zh/getting-started.html" target="_blank" rel="noopener">http://www.mybatis.org/mybatis-3/zh/getting-started.html</a></p>
<p>代码示例：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE mapper</span></span><br><span class="line"><span class="meta">        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"</span></span><br><span class="line"><span class="meta">        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.example.springboot.mapper.BillMapper"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getBillByBid"</span> <span class="attr">resultType</span>=<span class="string">"com.example.springboot.entities.Bill"</span>&gt;</span></span><br><span class="line">        select * from bill where bid = #&#123;bid&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"addBill"</span>&gt;</span></span><br><span class="line">        insert into bill(bill_code, bill_name, bill_com, bill_num)</span><br><span class="line">        values (#&#123;billCode&#125;, #&#123;billName&#125;, #&#123;billCom&#125;, #&#123;billNum&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>&lt;mapper namespace=&quot;com.example.springboot.mapper.BillMapper&quot;&gt;</code>定义了对应接口<code>BillMapper</code>的路径。</li>
<li>以查询为例，<code>select id=&quot;getBillByBid&quot;</code>，<code>getBillByBid</code>与接口中的方法<code>Bill getBillByBid(Integer bid);</code>对应，<code>resultType=&quot;com.example.springboot.entities.Bill&quot;</code>则是方法返回值的实体类<code>Bill</code>的路径。</li>
<li><code>#{}</code>用于表示一个占位符，相当于<code>?</code>，而<code>#{bid}</code>则表示该占位符待接收参数的名称为bid。</li>
</ul>
<h3 id="1-7-重新配置application-yml全局配置文件"><a href="#1-7-重新配置application-yml全局配置文件" class="headerlink" title="1.7 重新配置application.yml全局配置文件"></a>1.7 重新配置<code>application.yml</code>全局配置文件</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  datasource:</span></span><br><span class="line"><span class="attr">    username:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">    password:</span> <span class="string">root</span></span><br><span class="line">    <span class="comment"># mysql-connector-java 8.0版本以上的驱动包要指定时区</span></span><br><span class="line"><span class="attr">    url:</span> <span class="attr">jdbc:mysql://localhost:3306/mybatis?serverTimezone=GMT%2B8</span></span><br><span class="line">    <span class="comment"># mysql-connector-java 8.0版本以上指定了新的驱动类</span></span><br><span class="line"><span class="attr">    driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="comment"># 使用阿里的Druid（德鲁伊）数据源</span></span><br><span class="line"><span class="attr">    type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 数据源其他配置</span></span><br><span class="line"><span class="attr">    initialSize:</span> <span class="number">5</span></span><br><span class="line"><span class="attr">    minIdle:</span> <span class="number">5</span></span><br><span class="line"><span class="attr">    maxActive:</span> <span class="number">20</span></span><br><span class="line"><span class="attr">    maxWait:</span> <span class="number">60000</span></span><br><span class="line"><span class="attr">    timeBetweenEvictionRunsMillis:</span> <span class="number">60000</span></span><br><span class="line"><span class="attr">    minEvictableIdleTimeMillis:</span> <span class="number">300000</span></span><br><span class="line"><span class="attr">    validationQuery:</span> <span class="string">SELECT</span> <span class="number">1</span> <span class="string">FROM</span> <span class="string">DUAL</span></span><br><span class="line"><span class="attr">    testWhileIdle:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    testOnBorrow:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">    testOnReturn:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">    poolPreparedStatements:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment"># 配置监控统计拦截的filters，去掉后监控界面sql无法统计，'wall'用于防火墙</span></span><br><span class="line"><span class="attr">    filters:</span> <span class="string">stat,wall,logback</span></span><br><span class="line"><span class="attr">    maxPoolPreparedStatementPerConnectionSize:</span> <span class="number">20</span></span><br><span class="line"><span class="attr">    useGlobalDataSourceStat:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    connectionProperties:</span> <span class="string">druid.stat.mergeSql=true;druid.stat.slowSqlMillis=500</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># mybatis配置文件版，配置相关文件路径</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="comment"># 映射文件路径</span></span><br><span class="line"><span class="attr">  mapper-locations:</span> <span class="attr">classpath:mybatis/mapper/*.xml</span></span><br><span class="line">  <span class="comment"># mybatis核心配置文件路径</span></span><br><span class="line"><span class="attr">  config-location:</span> <span class="attr">classpath:mybatis/mybatis-config.xml</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>classpath:</code>表示类路径，在Spring Boot项目里等同于<code>resources</code>目录，在其他项目也可等同于<code>res</code>目录。</li>
<li><code>*.xml</code>表示该目录下所有.xml文件。</li>
</ul>
<h3 id="1-8-创建控制层"><a href="#1-8-创建控制层" class="headerlink" title="1.8 创建控制层"></a>1.8 创建控制层</h3><p>在com.example.springboot.controller包下新建类BillController：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BillController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    BillMapper billMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/bill/&#123;bid&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Bill <span class="title">getBillByBid</span><span class="params">(@PathVariable(<span class="string">"bid"</span>)</span> Integer bid) </span>&#123;</span><br><span class="line">        Bill bill = billMapper.getBillByBid(bid);</span><br><span class="line">        <span class="keyword">return</span> bill;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/bill"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Bill <span class="title">addBill</span><span class="params">(Bill bill)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = billMapper.addBill(bill);</span><br><span class="line">        <span class="keyword">return</span> bill;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>@RestController</code>注解等同于<code>@Controller</code>+<code>@ResponseBody</code>这两个注解合在一起的作用，表示不返回jsp或html页面，直接返回return的内容。</p>
</li>
<li><p><code>@Autowired
BillMapper billMapper;</code></p>
<p>表示直接将BillMapper接口注入。</p>
</li>
</ul>
<h3 id="1-9-测试"><a href="#1-9-测试" class="headerlink" title="1.9 测试"></a>1.9 测试</h3><p>启动启动类SpringBoot08DataMybatisApplication，在浏览器输入：<a href="http://localhost:8080/bill/1" target="_blank" rel="noopener">http://localhost:8080/bill/1</a></p>
<p>效果显示：</p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1555045035693.png" alt="1555045035693"></p>
<p>数据库中bill表：</p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1555042069834.png" alt="1555042069834"></p>
<p>网页中数据与数据库中均一一对应，表明成功。</p>
<h2 id="2-Spring-Boot整合MyBatis注解版"><a href="#2-Spring-Boot整合MyBatis注解版" class="headerlink" title="2. Spring Boot整合MyBatis注解版"></a>2. Spring Boot整合MyBatis注解版</h2><h3 id="2-1-建表"><a href="#2-1-建表" class="headerlink" title="2.1 建表"></a>2.1 建表</h3><p>同1.1，表已经建好。</p>
<h3 id="2-2-application-yml全局配置文件"><a href="#2-2-application-yml全局配置文件" class="headerlink" title="2.2 application.yml全局配置文件"></a>2.2 <code>application.yml</code>全局配置文件</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  datasource:</span></span><br><span class="line"><span class="attr">    username:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">    password:</span> <span class="string">root</span></span><br><span class="line">    <span class="comment"># mysql-connector-java 8.0版本以上的驱动包要指定时区</span></span><br><span class="line"><span class="attr">    url:</span> <span class="attr">jdbc:mysql://localhost:3306/mybatis?serverTimezone=GMT%2B8</span></span><br><span class="line">    <span class="comment"># mysql-connector-java 8.0版本以上指定了新的驱动类</span></span><br><span class="line"><span class="attr">    driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="comment"># 使用阿里的Druid（德鲁伊）数据源</span></span><br><span class="line"><span class="attr">    type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 数据源其他配置</span></span><br><span class="line"><span class="attr">    initialSize:</span> <span class="number">5</span></span><br><span class="line"><span class="attr">    minIdle:</span> <span class="number">5</span></span><br><span class="line"><span class="attr">    maxActive:</span> <span class="number">20</span></span><br><span class="line"><span class="attr">    maxWait:</span> <span class="number">60000</span></span><br><span class="line"><span class="attr">    timeBetweenEvictionRunsMillis:</span> <span class="number">60000</span></span><br><span class="line"><span class="attr">    minEvictableIdleTimeMillis:</span> <span class="number">300000</span></span><br><span class="line"><span class="attr">    validationQuery:</span> <span class="string">SELECT</span> <span class="number">1</span> <span class="string">FROM</span> <span class="string">DUAL</span></span><br><span class="line"><span class="attr">    testWhileIdle:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    testOnBorrow:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">    testOnReturn:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">    poolPreparedStatements:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment"># 配置监控统计拦截的filters，去掉后监控界面sql无法统计，'wall'用于防火墙</span></span><br><span class="line"><span class="attr">    filters:</span> <span class="string">stat,wall,logback</span></span><br><span class="line"><span class="attr">    maxPoolPreparedStatementPerConnectionSize:</span> <span class="number">20</span></span><br><span class="line"><span class="attr">    useGlobalDataSourceStat:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    connectionProperties:</span> <span class="string">druid.stat.mergeSql=true;druid.stat.slowSqlMillis=500</span></span><br></pre></td></tr></table></figure>
<h3 id="2-3-创建实体类"><a href="#2-3-创建实体类" class="headerlink" title="2.3 创建实体类"></a>2.3 创建实体类</h3><p>同1.3，实体类均已创建好。</p>
<h3 id="2-4-创建Mapper接口"><a href="#2-4-创建Mapper接口" class="headerlink" title="2.4 创建Mapper接口"></a>2.4 创建Mapper接口</h3><p>在 com.example.springboot.mapper 包下创建 ProviderMapper 接口。</p>
<p>代码示例：</p>
<ul>
<li><p>ProviderMapper接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用mybatis注解版</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span> <span class="comment">//这是指定操作数据的Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ProviderMapper</span> </span>&#123;</span><br><span class="line">    <span class="comment">//接口默认public修饰</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//查</span></span><br><span class="line">    <span class="meta">@Select</span>(<span class="string">"select * from provider where pid = #&#123;pid&#125;"</span>)</span><br><span class="line">    <span class="function">Provider <span class="title">getProviderByPid</span><span class="params">(Integer pid)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//增</span></span><br><span class="line">    <span class="meta">@Insert</span>(<span class="string">"insert into provider(providerName) values (#&#123;providerName&#125;)"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">addProvider</span><span class="params">(Provider provider)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//删</span></span><br><span class="line">    <span class="meta">@Delete</span>(<span class="string">"delete from provider where pid = #&#123;pid&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">deleteProviderByPid</span><span class="params">(Integer pid)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//改</span></span><br><span class="line">    <span class="meta">@Update</span>(<span class="string">"update provider set providerName = #&#123;providerName&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">updateProvider</span><span class="params">(Provider provider)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringBoot08DataMybatisApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(SpringBoot08DataMybatisApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="2-5-创建控制层"><a href="#2-5-创建控制层" class="headerlink" title="2.5 创建控制层"></a>2.5 创建控制层</h3><p>在 com.example.springboot.controller 包下创建ProviderController类。</p>
<p>代码示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProviderController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    ProviderMapper providerMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/provider/&#123;pid&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Provider <span class="title">getProvider</span><span class="params">(@PathVariable(<span class="string">"pid"</span>)</span> Integer pid) </span>&#123;</span><br><span class="line">        Provider provider = providerMapper.getProviderByPid(pid);</span><br><span class="line">        <span class="keyword">return</span> provider;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-6-创建MyBatis配置类"><a href="#2-6-创建MyBatis配置类" class="headerlink" title="2.6 创建MyBatis配置类"></a>2.6 创建MyBatis配置类</h3><p>因为MyBatis注解版没有xml配置文件，所以需要使用配置类来配置，我在 com.example.springboot.config 包下创建MyBatisConfig类，主要配置了开启了自动驼峰命名规则映射。</p>
<p>代码示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBatisConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ConfigurationCustomizer <span class="title">ConfigurationCustomizer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ConfigurationCustomizer configurationCustomizer = <span class="keyword">new</span> ConfigurationCustomizer() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">customize</span><span class="params">(org.apache.ibatis.session.Configuration configuration)</span> </span>&#123;</span><br><span class="line">                <span class="comment">//是否开启自动驼峰命名规则（camel case）映射，</span></span><br><span class="line">                <span class="comment">// 即从经典数据库列名 A_COLUMN 到经典 Java 属性名 aColumn 的类似映射。</span></span><br><span class="line">                configuration.setMapUnderscoreToCamelCase(<span class="keyword">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">return</span> configurationCustomizer;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-7-测试"><a href="#2-7-测试" class="headerlink" title="2.7 测试"></a>2.7 测试</h3><p>启动启动类SpringBoot08DataMybatisApplication，在浏览器输入：<a href="http://localhost:8080/provider/1" target="_blank" rel="noopener">http://localhost:8080/provider/1</a></p>
<p>网页效果：</p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1555066856653.png" alt="1555066856653"></p>
<p>数据表：</p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1555066918948.png" alt="1555066918948"></p>
<p>测试成功。</p>
<h2 id="3-心得"><a href="#3-心得" class="headerlink" title="3. 心得"></a>3. 心得</h2><p>无论Mybatis注解版还是配置文件版，都能实现相同功能，所以都需要掌握。</p>
<p>但是本人更倾向于配置文件版，因为如果遇到复杂的sql语句，写在注解上让代码显得特别繁琐复杂，而单独写在mapper映射文件中则显得简洁许多。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/04/10/Spring-Boot整合MyBatis/" data-id="cjupmu0td0014cwrc5xh2eev2" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MyBatis/">MyBatis</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MySQL/">MySQL</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Spring-Boot/">Spring Boot</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Spring-Boot事务管理" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/09/Spring-Boot事务管理/" class="article-date">
  <time datetime="2019-04-09T10:30:59.000Z" itemprop="datePublished">2019-04-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/09/Spring-Boot事务管理/">Spring Boot事务管理</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="1-事务管理"><a href="#1-事务管理" class="headerlink" title="1. 事务管理"></a>1. 事务管理</h2><h3 id="1-1-简介"><a href="#1-1-简介" class="headerlink" title="1.1 简介"></a>1.1 简介</h3><p>事务是应用程序中一系列严密的操作，所有操作必须成功完成，否则在每个操作中所作的所有更改都会被撤消。也就是事务具有原子性，一个事务中的一系列的操作要么全部成功，要么一个都不做。<br>事务的结束有两种，当事务中的所以步骤全部成功执行时，事务提交。如果其中一个步骤失败，将发生回滚操作，撤消撤消之前到事务开始时的所以操作。<br>在Spring Boot中，使用了<code>spring-boot-starter-jdbc</code>或者<code>spring-boot-starter-data-jpa</code>依赖时，框架会自动默认注入<code>DataSourceTransactionManager</code>或者<code>jpaTransactionManager</code>。所以我们不需要任何额外配置就可以用<code>@Transactional</code>注解进行事务的使用。</p>
<h3 id="1-2-事务管理步骤"><a href="#1-2-事务管理步骤" class="headerlink" title="1.2 事务管理步骤"></a>1.2 事务管理步骤</h3><ol>
<li><p>在启动类中，使用<code>@EnableTransactionManagement</code>开启注解方式事务管理支持。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableTransactionManagement</span> <span class="comment">//开启注解方式事务支持</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringBoot08DataJpaApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(SpringBoot08DataJpaApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol start="2">
<li><p>在Service层方法上使用<code>@Transactional</code>注解。</p>
<ul>
<li><p><code>@Transactional</code>也可直接注解在类上，这样默认该类下所有方法都开启事务注解。</p>
</li>
<li><p>但实际中一般只对 <strong>增</strong>、<strong>删</strong>、<strong>改</strong> 进行事务管理，不对 <strong>查</strong> 进行事务管理，所以注解在方法上。</p>
</li>
</ul>
</li>
</ol>
<h3 id="1-3-注意"><a href="#1-3-注意" class="headerlink" title="1.3 注意"></a>1.3 注意</h3><ol>
<li><p><code>application.yml</code>配置文件</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  datasource:</span></span><br><span class="line"><span class="attr">    username:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">    password:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">    url:</span> <span class="attr">jdbc:mysql://localhost:3306/jpa?serverTimezone=GMT%2B8</span></span><br><span class="line"><span class="attr">    driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># jpa相关配置</span></span><br><span class="line"><span class="attr">  jpa:</span></span><br><span class="line"><span class="attr">    hibernate:</span></span><br><span class="line">      <span class="comment"># 会根据映射实体类自动创建会更新数据表</span></span><br><span class="line"><span class="attr">      ddl-auto:</span> <span class="string">update</span></span><br><span class="line">    <span class="comment"># 控制台打印sql语句</span></span><br><span class="line"><span class="attr">    show-sql:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>如果使用 JPA（Java Persistence API），hibernate在自动创建表时，创建的表引擎是 <strong>MyISAM</strong>，是非事务安全的，无法实现事务回滚。需要指定 <strong>InnoDB</strong> 引擎才可以进行事务管理。</p>
</li>
<li><p>在<code>application.yml</code>配置文件中添加配置</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  datasource:</span></span><br><span class="line"><span class="attr">    username:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">    password:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">    url:</span> <span class="attr">jdbc:mysql://localhost:3306/jpa?serverTimezone=GMT%2B8</span></span><br><span class="line"><span class="attr">    driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># jpa相关配置</span></span><br><span class="line"><span class="attr">  jpa:</span></span><br><span class="line"><span class="attr">    hibernate:</span></span><br><span class="line">      <span class="comment"># 会根据映射实体类自动创建会更新数据表</span></span><br><span class="line"><span class="attr">      ddl-auto:</span> <span class="string">update</span></span><br><span class="line">    <span class="comment"># 控制台打印sql语句</span></span><br><span class="line"><span class="attr">    show-sql:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment"># 指定表的引擎为InnoDB，如果不指定，则默认表引擎为MyISAM,MyISAM是不支持事务管理的</span></span><br><span class="line"><span class="attr">    database-platform:</span> <span class="string">org.hibernate.dialect.MySQL57Dialect</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="2-事务的隔离级别"><a href="#2-事务的隔离级别" class="headerlink" title="2. 事务的隔离级别"></a>2. 事务的隔离级别</h2><h3 id="2-1-脏读、不可重复读和幻读"><a href="#2-1-脏读、不可重复读和幻读" class="headerlink" title="2.1 脏读、不可重复读和幻读"></a>2.1 脏读、不可重复读和幻读</h3><ol>
<li>脏读：A事务执行过程中修改了id=1的数据，未提交前，B事务读取了A事务修改的id=1的数据，而这时A事务却回滚了，这样B事务就形成了脏读。</li>
<li>不可重复读：A事务先读取了一条数据，然后执行逻辑，这时B事务将这条数据改变了，然后A事务再次读取这条数据，发现数据不匹配了，这就是不可重复读。</li>
<li>幻读：A事务先根据条件查询到了N调数据，然后这时B事务新增了M条符合A事务查询条件的数据，A事务再次查询时发现有N+M条数据了，就产生了幻读。</li>
</ol>
<h3 id="2-2-隔离级别"><a href="#2-2-隔离级别" class="headerlink" title="2.2 隔离级别"></a>2.2 隔离级别</h3><p>数据库事务的隔离级别有4个，由低到高依次为Read uncommitted 、Read committed 、Repeatable read 、Serializable ，这四个级别可以逐个解决脏读 、不可重复读 、幻读这几类问题。</p>
<table>
<thead>
<tr>
<th>隔离级别</th>
<th>脏读</th>
<th>不可重复读</th>
<th>幻读</th>
</tr>
</thead>
<tbody>
<tr>
<td>Read uncommitted（读未提交）</td>
<td>√</td>
<td>√</td>
<td>√</td>
</tr>
<tr>
<td>Read committed（读提交）</td>
<td>×</td>
<td>√</td>
<td>√</td>
</tr>
<tr>
<td>Repeatable read（重复读）</td>
<td>×</td>
<td>×</td>
<td>√</td>
</tr>
<tr>
<td>Serializable（序列化）</td>
<td>×</td>
<td>×</td>
<td>×</td>
</tr>
</tbody>
</table>
<h3 id="2-3-源码"><a href="#2-3-源码" class="headerlink" title="2.3 源码"></a>2.3 源码</h3><p>查看<code>org.springframework.transaction.annotation</code>包中的枚举类<code>Isolation</code>定义了五个表示隔离级别的值：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.transaction.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> Isolation &#123;</span><br><span class="line">    DEFAULT(-<span class="number">1</span>),</span><br><span class="line">    READ_UNCOMMITTED(<span class="number">1</span>),</span><br><span class="line">    READ_COMMITTED(<span class="number">2</span>),</span><br><span class="line">    REPEATABLE_READ(<span class="number">4</span>),</span><br><span class="line">    SERIALIZABLE(<span class="number">8</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> value;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Isolation</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">value</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>DEFAULT：默认值，表示使用底层数据库的默认隔离级别，大多数数据库的默认隔离级别是READ_COMMITTED。</li>
<li>READ_UNCOMMITTED：通常很少使用该隔离级别，因为避免不了脏读、不可重复读和幻读。</li>
<li><strong>READ_COMMITTED：可以防止脏读，也是大多数数据库的默认隔离级别，比如SQL Server , Oracle，性能最好。</strong></li>
<li>REPEATABLE_READ：可以避免脏读和不可重复读，是MySQL的默认隔离级别。</li>
<li>SERIALIZABLE：可以避免脏读、不可重复读和幻读，但严重影响程序性能，通常不会用到该级别。</li>
</ol>
<h3 id="2-4-指定隔离级别"><a href="#2-4-指定隔离级别" class="headerlink" title="2.4 指定隔离级别"></a>2.4 指定隔离级别</h3><p>在<code>@Transactional</code>注解上设置属性：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span>(isolation = Isolation.DEFAULT) </span><br><span class="line">   <span class="comment">//当前方法开启事务管理</span></span><br><span class="line">   <span class="comment">//isolation指定隔离级别，当前指定为默认</span></span><br></pre></td></tr></table></figure>
<h2 id="3-事务的传播行为"><a href="#3-事务的传播行为" class="headerlink" title="3. 事务的传播行为"></a>3. 事务的传播行为</h2><h3 id="3-1-源码"><a href="#3-1-源码" class="headerlink" title="3.1 源码"></a>3.1 源码</h3><p>查看<code>org.springframework.transaction.annotation</code>包中的枚举类<code>Propagation</code>定义了七个表示传播行为的值：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.transaction.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> Propagation &#123;</span><br><span class="line">    REQUIRED(<span class="number">0</span>),</span><br><span class="line">    SUPPORTS(<span class="number">1</span>),</span><br><span class="line">    MANDATORY(<span class="number">2</span>),</span><br><span class="line">    REQUIRES_NEW(<span class="number">3</span>),</span><br><span class="line">    NOT_SUPPORTED(<span class="number">4</span>),</span><br><span class="line">    NEVER(<span class="number">5</span>),</span><br><span class="line">    NESTED(<span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> value;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Propagation</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">value</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li><p>REQUIRED：支持当前事务，如果当前没有事务，就新建一个事务。<br>如果A方法有事务，那么B方法就使用A方法的事务。<br>如果A方法没有事务，那么B方法就创建一个新事物。<br><strong>是Spring提供的默认事务传播行为，适合绝大数情况。</strong></p>
</li>
<li><p>SUPPORTS：支持当前事务，如果当前没有事务，就以非事务方式执行。<br>如果A方法有事务，那么B方法就使用A方法的事务。<br>如果A方法没有事务，那么B方法就不使用事务的方式执行</p>
</li>
<li><p>MANDATORY：支持当前事务，如果当前没有事务，就抛出异常。<br>如果A方法有事务，那么A方法就使用A方法事务。<br>如果A方法没有事务，那么就抛出异常。<br><strong>该事务传播行为要求A方法必须以事务的方式运行。</strong></p>
</li>
<li><p>REQUIRES_NEW：新建事务，如果当前存在事务，把当前事务挂起。<br>如果A方法有事务，就把A方法的事务挂起，B方法新创建一个事务。<br>如果A方法没有事务，那么B方法就创建一个新事务。</p>
</li>
<li><p>NOT_SUPPORTED：以非事务方式执行操作，如果当前存在事务，就把当前事务挂起。<br>如果A方法有事务，那么就把A方法的事务挂起，B方法以非事务的方式执行。<br>如果A方法没有事务，那么B也不使用事务执行。</p>
</li>
<li><p>NEVER：以非事务方式执行，如果当前存在事务，则抛出异常。<br>如果方法A有事务，那么就抛出异常。<br>如果方法A没有事务，那么B方法就以非事务的方式运行。</p>
</li>
<li><p>NESTED：如果当前存在事务，则在嵌套事务内执行。如果当前没有事务，则进行与PROPAGATION_REQUIRED类似的。<br>如果A方法有事务，那么B方法就在A方法的事务中使用嵌套事务。<br>如果A方法没有事务，那么方法B就新创建一个事务。</p>
</li>
</ol>
<h3 id="3-2-指定传播行为"><a href="#3-2-指定传播行为" class="headerlink" title="3.2 指定传播行为"></a>3.2 指定传播行为</h3><p>在<code>@Transactional</code>注解上设置属性：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span>(isolation = Isolation.DEFAULT, propagation = Propagation.REQUIRED )</span><br><span class="line"><span class="comment">//当前方法开启事务管理</span></span><br><span class="line"><span class="comment">//isolation指定隔离级别，当前指定为默认</span></span><br><span class="line"><span class="comment">//propagation指定传播行为，当前指定为默认</span></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/04/09/Spring-Boot事务管理/" data-id="cjupmu0tc0013cwrc7qijcg1s" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Spring-Boot/">Spring Boot</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/事务管理/">事务管理</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-配置Druid数据库连接池" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/04/配置Druid数据库连接池/" class="article-date">
  <time datetime="2019-04-04T08:22:50.000Z" itemprop="datePublished">2019-04-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/04/配置Druid数据库连接池/">配置Druid数据库连接池</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="1-配置Druid数据库连接池"><a href="#1-配置Druid数据库连接池" class="headerlink" title="1. 配置Druid数据库连接池"></a>1. 配置Druid数据库连接池</h2><p>什么是数据库连接池？</p>
<p>参考：<a href="https://www.cnblogs.com/aspirant/p/6747238.html" target="_blank" rel="noopener">https://www.cnblogs.com/aspirant/p/6747238.html</a></p>
<ul>
<li><strong>Spring Boot 2.0 </strong>默认使用 <strong>HikariCP</strong> 作为数据库连接池。</li>
<li><strong>Druid</strong> 是阿里巴巴推出的国产数据库连接池，据网上测试对比，比目前的 <strong>DBCP</strong> 或 <strong>C3P0</strong> 数据库连接池性能更好，并且 <strong>Druid</strong> 能够提供强大的监控和扩展功能。</li>
</ul>
<h3 id="1-1-在pom-xml中引入依赖"><a href="#1-1-在pom-xml中引入依赖" class="headerlink" title="1.1 在pom.xml中引入依赖"></a>1.1 在<code>pom.xml</code>中引入依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.alibaba/druid --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.15<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="1-2-在全局配置文件application-yml中配置"><a href="#1-2-在全局配置文件application-yml中配置" class="headerlink" title="1.2 在全局配置文件application.yml中配置"></a>1.2 在全局配置文件<code>application.yml</code>中配置</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  datasource:</span></span><br><span class="line"><span class="attr">    username:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">    password:</span> <span class="string">root</span></span><br><span class="line">    <span class="comment"># mysql-connector-java 8.0版本以上的驱动包要指定时区</span></span><br><span class="line"><span class="attr">    url:</span> <span class="attr">jdbc:mysql://localhost:3306/jdbc?serverTimezone=GMT%2B8</span></span><br><span class="line">    <span class="comment"># mysql-connector-java 8.0版本以上指定了新的驱动类</span></span><br><span class="line"><span class="attr">    driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="comment"># 使用阿里的Druid（德鲁伊）数据源</span></span><br><span class="line"><span class="attr">    type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 数据源其他配置</span></span><br><span class="line"><span class="attr">    initialSize:</span> <span class="number">5</span></span><br><span class="line"><span class="attr">    minIdle:</span> <span class="number">5</span></span><br><span class="line"><span class="attr">    maxActive:</span> <span class="number">20</span></span><br><span class="line"><span class="attr">    maxWait:</span> <span class="number">60000</span></span><br><span class="line"><span class="attr">    timeBetweenEvictionRunsMillis:</span> <span class="number">60000</span></span><br><span class="line"><span class="attr">    minEvictableIdleTimeMillis:</span> <span class="number">300000</span></span><br><span class="line"><span class="attr">    validationQuery:</span> <span class="string">SELECT</span> <span class="number">1</span> <span class="string">FROM</span> <span class="string">DUAL</span></span><br><span class="line"><span class="attr">    testWhileIdle:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    testOnBorrow:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">    testOnReturn:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">    poolPreparedStatements:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment"># 配置监控统计拦截的filters，去掉后监控界面sql无法统计，'wall'用于防火墙</span></span><br><span class="line"><span class="attr">    filters:</span> <span class="string">stat,wall,logback</span></span><br><span class="line"><span class="attr">    maxPoolPreparedStatementPerConnectionSize:</span> <span class="number">20</span></span><br><span class="line"><span class="attr">    useGlobalDataSourceStat:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    connectionProperties:</span> <span class="string">druid.stat.mergeSql=true;druid.stat.slowSqlMillis=500</span></span><br></pre></td></tr></table></figure>
<h3 id="1-3-绑定Druid相关信息"><a href="#1-3-绑定Druid相关信息" class="headerlink" title="1.3 绑定Druid相关信息"></a>1.3 绑定Druid相关信息</h3><p>在config目录下新建类<code>DruidConfig</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DruidConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"spring.datasource"</span>)</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">druid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DruidDataSource();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>至此Druid数据库连接池配置完毕。</p>
<h2 id="2-配置Druid的监控"><a href="#2-配置Druid的监控" class="headerlink" title="2. 配置Druid的监控"></a>2. 配置Druid的监控</h2><p><strong>Druid</strong> 自带监控管理系统，要配置一个Druid监控：</p>
<ol>
<li>配置一个Druid的Servlet</li>
<li>配置一个Druid的Filter</li>
<li>完成</li>
</ol>
<h3 id="2-1-配置一个Druid的Servlet"><a href="#2-1-配置一个Druid的Servlet" class="headerlink" title="2.1 配置一个Druid的Servlet"></a>2.1 配置一个Druid的Servlet</h3><p>在config目录下<code>DruidConfig</code>类下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//配置一个Druid的后台管理系统的Servlet</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ServletRegistrationBean <span class="title">statViewServlet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//请求是/druid/*</span></span><br><span class="line">    ServletRegistrationBean&lt;StatViewServlet&gt; bean = <span class="keyword">new</span> ServletRegistrationBean&lt;&gt;(<span class="keyword">new</span> StatViewServlet(), <span class="string">"/druid/*"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置初始化参数值</span></span><br><span class="line">    Map&lt;String, String&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    map.put(StatViewServlet.PARAM_NAME_USERNAME, <span class="string">"root"</span>);</span><br><span class="line">    map.put(StatViewServlet.PARAM_NAME_PASSWORD, <span class="string">"123456"</span>);</span><br><span class="line">    <span class="comment">//如果不写，则默认所有IP地址都可以访问</span></span><br><span class="line">    map.put(StatViewServlet.PARAM_NAME_ALLOW, <span class="string">""</span>);</span><br><span class="line">    <span class="comment">//指定IP地址禁止访问</span></span><br><span class="line">    map.put(StatViewServlet.PARAM_NAME_DENY, <span class="string">"192.168.1.1"</span>);</span><br><span class="line">    bean.setInitParameters(map);</span><br><span class="line">    <span class="keyword">return</span> bean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-2-配置一个Druid的Filter"><a href="#2-2-配置一个Druid的Filter" class="headerlink" title="2.2 配置一个Druid的Filter"></a>2.2 配置一个Druid的Filter</h3><p>在config目录下<code>DruidConfig</code>类下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//配置一个Druid的Filter</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> FilterRegistrationBean <span class="title">webStatFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    FilterRegistrationBean&lt;Filter&gt; bean = <span class="keyword">new</span> FilterRegistrationBean&lt;&gt;();</span><br><span class="line">    bean.setFilter(<span class="keyword">new</span> WebStatFilter());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置不拦截的请求</span></span><br><span class="line">    Map&lt;String, String&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    map.put(WebStatFilter.PARAM_NAME_EXCLUSIONS, <span class="string">"*.js, *.css, /druid/*"</span>);</span><br><span class="line">    bean.setInitParameters(map);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置拦截请求, /* 表示拦截所有请求</span></span><br><span class="line">    bean.setUrlPatterns(Arrays.asList(<span class="string">"/*"</span>));</span><br><span class="line">    <span class="keyword">return</span> bean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/04/04/配置Druid数据库连接池/" data-id="cjupmu0t0000fcwrcvpnrca6x" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Druid/">Druid</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Spring-Boot/">Spring Boot</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Spring-Boot嵌入式Servlet容器" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/03/Spring-Boot嵌入式Servlet容器/" class="article-date">
  <time datetime="2019-04-03T07:11:02.000Z" itemprop="datePublished">2019-04-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/03/Spring-Boot嵌入式Servlet容器/">Spring Boot嵌入式Servlet容器</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="1-修改Servlet配置"><a href="#1-修改Servlet配置" class="headerlink" title="1. 修改Servlet配置"></a>1. 修改Servlet配置</h2><p>参考<code>pom.xml</code>文件可以知道，Spring Boot默认使用Tomcat作为嵌入式的Servlet容器。</p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1554275834188.png" alt="1554275834188"></p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\1554275920854.png" alt="1554275920854"></p>
<h3 id="1-1-通过全局配置文件修改Servlet配置"><a href="#1-1-通过全局配置文件修改Servlet配置" class="headerlink" title="1.1 通过全局配置文件修改Servlet配置"></a>1.1 通过全局配置文件修改Servlet配置</h3><p>通过修改全局配置文件<code>application.properties</code>，修改嵌入式Servlet容器配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 修改关于服务的相关配置，对应的类是ServerProperties</span><br><span class="line"></span><br><span class="line"># 修改端口号</span><br><span class="line">server.port=8081</span><br><span class="line"></span><br><span class="line"># 修改Servlet的相关配置，修改应用名</span><br><span class="line">server.servlet.context-path=/servlet</span><br><span class="line"></span><br><span class="line"># 修改Tomcat的相关配置</span><br><span class="line">server.tomcat.max-connections=80000</span><br></pre></td></tr></table></figure>
<h3 id="1-2-通过自定义配置器修改Servlet配置"><a href="#1-2-通过自定义配置器修改Servlet配置" class="headerlink" title="1.2 通过自定义配置器修改Servlet配置"></a>1.2 通过自定义配置器修改Servlet配置</h3><p><strong>Spring Boot 2.x：</strong></p>
<p>实现<code>WebServerFactoryCustomizer</code>接口的<code>customize</code>抽象方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义定制器修改Servlet容器配置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> WebServerFactoryCustomizer <span class="title">webServerFactoryCustomizer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//采用匿名内部类实现WebServerFactoryCustomizer接口的void customize(T factory)抽象方法</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> WebServerFactoryCustomizer() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">customize</span><span class="params">(WebServerFactory factory)</span> </span>&#123;</span><br><span class="line">            ConfigurableServletWebServerFactory factory1 =</span><br><span class="line">                    (ConfigurableServletWebServerFactory) factory;</span><br><span class="line">            <span class="comment">//修改端口号，如果全局配置文件中的配置与定制器的配置冲突，默认采用定制器的配置</span></span><br><span class="line">            factory1.setPort(<span class="number">8082</span>);</span><br><span class="line">            <span class="comment">//修改应用名</span></span><br><span class="line">            factory1.setContextPath(<span class="string">"/servlet2"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="2-切换为其他嵌入式Servlet容器"><a href="#2-切换为其他嵌入式Servlet容器" class="headerlink" title="2. 切换为其他嵌入式Servlet容器"></a>2. 切换为其他嵌入式Servlet容器</h2><p>Spring Boot默认针对Servlet容器提供以下支持：</p>
<ul>
<li>Tomcat（默认使用）。</li>
<li>Jetty：支持长连接项目（如：聊天页面）。</li>
<li>Undertow：不支持jsp，但是并发性能高，是高性能非阻塞的容器。</li>
</ul>
<h3 id="2-1-使用Jetty"><a href="#2-1-使用Jetty" class="headerlink" title="2.1 使用Jetty"></a>2.1 使用Jetty</h3><ol>
<li><p>在<code>pom.xml</code>文件中移除Tomcat</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 移除Tomcat启动器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>引入Jetty依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引入Jetty启动器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jetty<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="2-2-使用Undertow"><a href="#2-2-使用Undertow" class="headerlink" title="2.2 使用Undertow"></a>2.2 使用Undertow</h3><ol>
<li><p>在<code>pom,xml</code>文件中移除Tomcat，代码同上。</p>
</li>
<li><p>引入Undertow依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引入Undertow启动器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-undertow<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/04/03/Spring-Boot嵌入式Servlet容器/" data-id="cjupmu0ss0004cwrccpkrxf4e" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Servlet/">Servlet</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Spring-Boot/">Spring Boot</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Spring-Boot中pom文件的依赖配置" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/02/Spring-Boot中pom文件的依赖配置/" class="article-date">
  <time datetime="2019-04-02T10:35:35.000Z" itemprop="datePublished">2019-04-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/02/Spring-Boot中pom文件的依赖配置/">Spring Boot中pom文件的依赖配置</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="1-pom-xml文件中依赖配置"><a href="#1-pom-xml文件中依赖配置" class="headerlink" title="1. pom.xml文件中依赖配置"></a>1. <code>pom.xml</code>文件中依赖配置</h2><p>Spring Boot中需要使用什么，只需在<code>pom.xml</code>文件中引入相对应的依赖即可，以下来介绍各种依赖。</p>
<h3 id="1-1-thymeleaf模板启动器"><a href="#1-1-thymeleaf模板启动器" class="headerlink" title="1.1 thymeleaf模板启动器"></a>1.1 thymeleaf模板启动器</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引入thymeleaf模板启动器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="1-2-注释处理器"><a href="#1-2-注释处理器" class="headerlink" title="1.2 注释处理器"></a>1.2 注释处理器</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 该依赖为注释处理器，在编写配置文件时能自动提示自定义的类 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="1-3-热部署"><a href="#1-3-热部署" class="headerlink" title="1.3 热部署"></a>1.3 热部署</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 热部署依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="1-4-jquery-webjars"><a href="#1-4-jquery-webjars" class="headerlink" title="1.4 jquery webjars"></a>1.4 jquery webjars</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引入jquery webjars --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.webjars<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jquery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.1-2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="1-5-Druid数据库连接池"><a href="#1-5-Druid数据库连接池" class="headerlink" title="1.5 Druid数据库连接池"></a>1.5 Druid数据库连接池</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Druid数据库连接池 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.alibaba/druid --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.15<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="1-6-MyBatis"><a href="#1-6-MyBatis" class="headerlink" title="1.6 MyBatis"></a>1.6 MyBatis</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- MyBatis启动器，已经引入了spring-boot-starter-jdbc启动器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="1-7-JDBC"><a href="#1-7-JDBC" class="headerlink" title="1.7 JDBC"></a>1.7 JDBC</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="1-8-Java连接MySQL驱动包"><a href="#1-8-Java连接MySQL驱动包" class="headerlink" title="1.8 Java连接MySQL驱动包"></a>1.8 Java连接MySQL驱动包</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Java连接MySQL驱动包 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/04/02/Spring-Boot中pom文件的依赖配置/" data-id="cjupmu0si0000cwrcjqfzttxi" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Spring-Boot/">Spring Boot</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Spring-Boot实现热部署" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/02/Spring-Boot实现热部署/" class="article-date">
  <time datetime="2019-04-02T02:51:07.000Z" itemprop="datePublished">2019-04-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/02/Spring-Boot实现热部署/">Spring Boot实现热部署</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="1-Spring-Boot实现项目的热部署"><a href="#1-Spring-Boot实现项目的热部署" class="headerlink" title="1. Spring Boot实现项目的热部署"></a>1. Spring Boot实现项目的热部署</h2><h3 id="1-1-简介"><a href="#1-1-简介" class="headerlink" title="1.1 简介"></a>1.1 简介</h3><p>Spring Boot项目的热部署，按照我的理解，就是在修改代码后，无须重新启动服务器，只需要重新Build Project，然后刷新网页，就可以立即在网页查看到修改后的变化。</p>
<h3 id="1-2-在配置文件中禁用模板缓存"><a href="#1-2-在配置文件中禁用模板缓存" class="headerlink" title="1.2 在配置文件中禁用模板缓存"></a>1.2 在配置文件中禁用模板缓存</h3><p>如果不禁用缓存，那么因为有网页的缓存，变化无法实时获取，所以在配置文件<code>application.properties</code>或者<code>application,yml</code>中禁用Thymeleaf模板缓存，下面以<code>application.properties</code>配置文件为例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 开发中推荐关闭thymeleaf的缓存，可以实现热部署</span><br><span class="line">spring.thymeleaf.cache=false</span><br></pre></td></tr></table></figure>
<h3 id="1-3-在pom-xml文件中引入依赖"><a href="#1-3-在pom-xml文件中引入依赖" class="headerlink" title="1.3 在pom.xml文件中引入依赖"></a>1.3 在<code>pom.xml</code>文件中引入依赖</h3><p>在<code>pom.xml</code>文件中引入热部署依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 热部署依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="1-4-实现"><a href="#1-4-实现" class="headerlink" title="1.4 实现"></a>1.4 实现</h3><p>按IDEA快捷键 <strong>ctrl+F9</strong> 进行Build Project，无须重新启动服务器，然后刷新网页即可实现项目的热部署。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/04/02/Spring-Boot实现热部署/" data-id="cjupmu0sq0003cwrclfg45v5p" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Spring-Boot/">Spring Boot</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Spring-Boot整合Thymeleaf（二）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/03/31/Spring-Boot整合Thymeleaf（二）/" class="article-date">
  <time datetime="2019-03-31T05:42:54.000Z" itemprop="datePublished">2019-03-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/03/31/Spring-Boot整合Thymeleaf（二）/">Spring Boot整合Thymeleaf（二）</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="1-声明公共代码片段"><a href="#1-声明公共代码片段" class="headerlink" title="1. 声明公共代码片段"></a>1. 声明公共代码片段</h2><h3 id="1-1-简介"><a href="#1-1-简介" class="headerlink" title="1.1 简介"></a>1.1 简介</h3><p>有两种方式声明公共代码片段：</p>
<ol>
<li>通过<code>th:fragment</code>声明公共代码片段。</li>
<li>通过id选择器声明公共代码片段。</li>
</ol>
<h3 id="1-2-通过th-fragment声明"><a href="#1-2-通过th-fragment声明" class="headerlink" title="1.2 通过th:fragment声明"></a>1.2 通过<code>th:fragment</code>声明</h3><p>示例：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 通过th:fragment声明公共代码片段 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:fragment</span>=<span class="string">"header_common"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        文字内容</span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="1-3-通过id选择器声明"><a href="#1-3-通过id选择器声明" class="headerlink" title="1.3 通过id选择器声明"></a>1.3 通过id选择器声明</h3><p>示例：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 通过id选择器进行声明公共代码片段 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"header_common_id"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        文字内容</span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="2-引入公共代码片段"><a href="#2-引入公共代码片段" class="headerlink" title="2. 引入公共代码片段"></a>2. 引入公共代码片段</h2><h3 id="2-1-简介"><a href="#2-1-简介" class="headerlink" title="2.1 简介"></a>2.1 简介</h3><p>有两种方式引入申明过的公共代码片段：</p>
<ol>
<li>通过<code>th:replace</code>引入：不保留引入公共代码片段时当前所使用的标签，即用引入的标签 <strong>替换</strong> 当前标签。</li>
<li>通过<code>th:insert</code>引入：保留引入公共代码片段时当前所使用的标签，即将公共代码块 <strong>插入</strong> 当前标签，变成当前标签的子标签。</li>
</ol>
<h3 id="2-2-通过th-replace引入"><a href="#2-2-通过th-replace引入" class="headerlink" title="2.2 通过th:replace引入"></a>2.2 通过<code>th:replace</code>引入</h3><h4 id="2-2-1-引入通过th-fragment声明的公共代码片段"><a href="#2-2-1-引入通过th-fragment声明的公共代码片段" class="headerlink" title="2.2.1 引入通过th:fragment声明的公共代码片段"></a>2.2.1 引入通过<code>th:fragment</code>声明的公共代码片段</h4><p>示例：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 通过th:replace引入通过th:fragment声明公共代码片段</span></span><br><span class="line"><span class="comment">     注意header是文件名，header_common就是声明的属性值</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:replace</span>=<span class="string">"header :: header_common"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="2-2-2-引入通过id选择器声明的公共代码片段"><a href="#2-2-2-引入通过id选择器声明的公共代码片段" class="headerlink" title="2.2.2 引入通过id选择器声明的公共代码片段"></a>2.2.2 引入通过id选择器声明的公共代码片段</h4><p>示例：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 通过th:replace引入通过id选择器进行声明公共代码片段</span></span><br><span class="line"><span class="comment">	 注意header是文件名，#header_common_id就是声明的id值</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:replace</span>=<span class="string">"header :: #header_common_id"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-3-通过th-insert引入"><a href="#2-3-通过th-insert引入" class="headerlink" title="2.3 通过th:insert引入"></a>2.3 通过<code>th:insert</code>引入</h3><h4 id="2-3-1-引入通过th-fragment声明的公共代码片段"><a href="#2-3-1-引入通过th-fragment声明的公共代码片段" class="headerlink" title="2.3.1 引入通过th:fragment声明的公共代码片段"></a>2.3.1 引入通过<code>th:fragment</code>声明的公共代码片段</h4><p>示例：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">th:insert</span>=<span class="string">"header :: #header_common"</span>&gt;</span><span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="2-3-2-引入通过id选择器声明的公共代码片段"><a href="#2-3-2-引入通过id选择器声明的公共代码片段" class="headerlink" title="2.3.2 引入通过id选择器声明的公共代码片段"></a>2.3.2 引入通过id选择器声明的公共代码片段</h4><p>示例：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">th:insert</span>=<span class="string">"header :: #header_common_id"</span>&gt;</span><span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/03/31/Spring-Boot整合Thymeleaf（二）/" data-id="cjupmu0sw0009cwrcwt1x039e" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Spring-Boot/">Spring Boot</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Thymeleaf/">Thymeleaf</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Druid/">Druid</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MyBatis/">MyBatis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/">MySQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Servlet/">Servlet</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring-Boot/">Spring Boot</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Thymeleaf/">Thymeleaf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/YAML/">YAML</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/事务管理/">事务管理</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/定时任务/">定时任务</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/异步任务/">异步任务</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/旅行/">旅行</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/邮件/">邮件</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Druid/" style="font-size: 10px;">Druid</a> <a href="/tags/MyBatis/" style="font-size: 10px;">MyBatis</a> <a href="/tags/MySQL/" style="font-size: 10px;">MySQL</a> <a href="/tags/Servlet/" style="font-size: 10px;">Servlet</a> <a href="/tags/Spring-Boot/" style="font-size: 20px;">Spring Boot</a> <a href="/tags/Thymeleaf/" style="font-size: 15px;">Thymeleaf</a> <a href="/tags/YAML/" style="font-size: 10px;">YAML</a> <a href="/tags/事务管理/" style="font-size: 10px;">事务管理</a> <a href="/tags/定时任务/" style="font-size: 10px;">定时任务</a> <a href="/tags/异步任务/" style="font-size: 10px;">异步任务</a> <a href="/tags/旅行/" style="font-size: 10px;">旅行</a> <a href="/tags/邮件/" style="font-size: 10px;">邮件</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/04/20/2019-04-21-23上海旅行规划/">2019.04.21-23上海旅行规划</a>
          </li>
        
          <li>
            <a href="/2019/04/19/Spring-Boot邮件操作/">Spring Boot邮件操作</a>
          </li>
        
          <li>
            <a href="/2019/04/17/Spring-Boot异步任务和定时任务/">Spring Boot异步任务和定时任务</a>
          </li>
        
          <li>
            <a href="/2019/04/10/Spring-Boot整合MyBatis/">Spring Boot整合MyBatis</a>
          </li>
        
          <li>
            <a href="/2019/04/09/Spring-Boot事务管理/">Spring Boot事务管理</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>